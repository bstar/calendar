import { Meta, Story, Canvas } from '@storybook/addon-docs';
import { CLACalendar } from './CLACalendar';
import { createStoryParameters } from './utils/story-helpers';
import {
  WeekdayRestrictionsStory,
  DateRangeRestrictionsStory,
  BoundaryRestrictionsStory,
  CombinedRestrictionsStory,
  AllowedRangesOnlyStory,
  DynamicRestrictionsStory,
  RestrictedBoundaryStory,
} from './stories/RestrictionsStories';
import {
  weekdayRestrictionsCode,
  dateRangeRestrictionsCode,
  dynamicRestrictionsCode,
  boundaryRestrictionsCode,
  combinedRestrictionsCode,
  allowedRangesCode,
  restrictedBoundaryCode,
} from './stories/code-examples';

<Meta title="Calendar/Date Restrictions" component={CLACalendar} />

# Date Restrictions

Control which dates users can select in the calendar based on various business rules and requirements.

## Overview

Date restrictions are essential for:
- üìÖ **Booking systems** - Block unavailable dates
- üíº **Business applications** - Exclude weekends/holidays  
- ‚è∞ **Scheduling tools** - Set valid date ranges
- ‚úÖ **Compliance** - Enforce date boundaries

## How Restrictions Work

When a user tries to select a restricted date:
1. The date appears visually disabled (striped pattern)
2. Selection is prevented
3. Optional message explains why
4. Selection remains on last valid date

## Restriction Types

### 1. Weekday Restrictions
Block specific days of the week (e.g., weekends)

### 2. Date Range Restrictions  
Block specific date ranges (e.g., holidays, maintenance)

### 3. Boundary Restrictions
Set minimum/maximum selectable dates

### 4. Allowed Ranges
Only allow selection within specific ranges

### 5. Restricted Boundary
Complex boundary rules with exceptions

---

## Weekday Restrictions

Block specific days of the week from selection. Perfect for business applications that only operate on weekdays.

### Configuration
- **Type**: `weekday`
- **Days**: Array of day numbers (0=Sunday, 6=Saturday)
- **Message**: Optional explanation for users

<Canvas withSource="open">
  <Story name="Weekday Restrictions" parameters={createStoryParameters(weekdayRestrictionsCode)}>
    {() => <WeekdayRestrictionsStory />}
  </Story>
</Canvas>

### How It Works

- **Visual Indication** - Weekends show striped pattern
- **Selection Prevention** - Cannot select or drag through weekends
- **Range Selection** - Automatically skips weekends when dragging
- **Clear Feedback** - Message explains why dates are restricted

### Common Patterns

<table>
  <thead>
    <tr>
      <th>Pattern</th>
      <th>Configuration</th>
      <th>Use Case</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Business Days</td>
      <td><code>days: [0, 6]</code></td>
      <td>Mon-Fri operations</td>
    </tr>
    <tr>
      <td>Specific Day</td>
      <td><code>days: [3]</code></td>
      <td>Block Wednesdays</td>
    </tr>
    <tr>
      <td>Multiple Days</td>
      <td><code>days: [2, 4]</code></td>
      <td>Block Tue & Thu</td>
    </tr>
    <tr>
      <td>Weekends Only</td>
      <td><code>days: [1,2,3,4,5]</code></td>
      <td>Weekend events</td>
    </tr>
  </tbody>
</table>

---

## Date Range Restrictions

Block specific date ranges from selection. Ideal for blackout periods, maintenance windows, or fully booked periods.

### Configuration
- **Type**: `daterange`
- **Ranges**: Array of date ranges to block
- **Flexible**: Multiple non-overlapping ranges

<Canvas withSource="open">
  <Story name="Date Range Restrictions" parameters={createStoryParameters(dateRangeRestrictionsCode)}>
    {() => <DateRangeRestrictionsStory />}
  </Story>
</Canvas>

### Use Cases

- **Blackout Periods** - Company holidays, maintenance windows
- **Fully Booked** - No availability in specific periods
- **Special Events** - Conference dates, peak seasons
- **Resource Conflicts** - Equipment unavailable

> **Best Practice**: Combine date range restrictions with event layers to provide visual context for why dates are blocked.

---

## Boundary Restrictions

Set minimum and maximum selectable dates. Essential for booking windows, project timelines, or validity periods.

### Configuration
- **Type**: `boundary`
- **Direction**: `before` or `after`
- **Date**: The boundary date
- **Inclusive**: Whether boundary date is selectable

<Canvas withSource="open">
  <Story name="Boundary Restrictions" parameters={createStoryParameters(boundaryRestrictionsCode)}>
    {() => <BoundaryRestrictionsStory />}
  </Story>
</Canvas>

### How It Works

1. **Minimum Date** - Use `direction: 'before'` to set earliest date
2. **Maximum Date** - Use `direction: 'after'` to set latest date
3. **Inclusive Option** - Control if boundary date is selectable
4. **Visual Feedback** - Dates outside boundaries are marked

### Common Scenarios

<table>
  <thead>
    <tr>
      <th>Scenario</th>
      <th>Configuration</th>
      <th>Example</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Booking Window</td>
      <td>Min date = today, Max = +30 days</td>
      <td>"Book up to 30 days ahead"</td>
    </tr>
    <tr>
      <td>Project Timeline</td>
      <td>Fixed start/end dates</td>
      <td>"Select within project duration"</td>
    </tr>
    <tr>
      <td>Seasonal</td>
      <td>Specific months only</td>
      <td>"Available June-September"</td>
    </tr>
    <tr>
      <td>Historical</td>
      <td>No past dates</td>
      <td>"No dates before today"</td>
    </tr>
  </tbody>
</table>

---

## Combined Restrictions

Use multiple restriction types together for complex business rules. This example combines weekday, date range, and boundary restrictions.

### Features
- Multiple restriction types working together
- Layered rules for comprehensive control
- Clear messaging for each restriction

<Canvas withSource="open">
  <Story name="Combined Restrictions" parameters={createStoryParameters(combinedRestrictionsCode)}>
    {() => <CombinedRestrictionsStory />}
  </Story>
</Canvas>

### Real-World Example

This demonstrates a booking system with:
1. **No Weekend Bookings** - Business operates Monday-Friday
2. **Holiday Closures** - Specific dates when closed
3. **Booking Window** - Limited to February-March
4. **Clear Communication** - Each restriction explains why

### Best Practices

- **Order Matters** - Place most restrictive rules first
- **Clear Messages** - Each restriction should explain itself
- **Test Combinations** - Ensure rules don't conflict
- **User Experience** - Provide alternatives when possible

---

## Allowed Ranges Only

Inverse restriction approach - only allow selection within specific ranges. Everything else is automatically restricted.

### Configuration
- **Type**: `allowedranges`  
- **Ranges**: Only these ranges are selectable
- **Everything Else**: Automatically restricted

<Canvas withSource="open">
  <Story name="Allowed Ranges Only" parameters={createStoryParameters(allowedRangesCode)}>
    {() => <AllowedRangesOnlyStory />}
  </Story>
</Canvas>

### How It Works

1. **Defines Available Periods** - Only these dates can be selected
2. **Blocks Everything Else** - All other dates restricted
3. **Clear Availability** - Users see exactly what's available
4. **Simplified Logic** - Sometimes easier than multiple exclusions

### Use Cases

- **Appointment Slots** - Pre-defined availability windows
- **Course Sessions** - Specific weeks for enrollment
- **Rental Periods** - Fixed-duration rentals  
- **Event Registration** - Limited time slots

---

## Dynamic Restrictions

Implement restrictions that change based on user interaction or external data.

### Features
- Real-time restriction updates
- Different modes for different scenarios
- Immediate visual feedback

<Canvas withSource="open">
  <Story name="Dynamic Restrictions" parameters={createStoryParameters(dynamicRestrictionsCode)}>
    {() => <DynamicRestrictionsStory />}
  </Story>
</Canvas>

### Dynamic Patterns

1. **User Role Based** - Different restrictions for different users
2. **Time-based** - Restrictions that change throughout the day
3. **Availability Based** - Real-time availability from backend
4. **Conditional Logic** - Rules based on other selections

---

## Restricted Boundary

The most complex restriction type - sophisticated boundary rules with exceptions and special cases.

### Configuration
- **Type**: `restricted_boundary`
- **Base Boundary**: Overall date limits
- **Exceptions**: Specific ranges that override
- **Complex Logic**: Rules within rules

<Canvas withSource="open">
  <Story name="Restricted Boundary" parameters={createStoryParameters(restrictedBoundaryCode)}>
    {() => <RestrictedBoundaryStory />}
  </Story>
</Canvas>

### Advanced Logic

The restricted_boundary type enables:

1. **Base Boundaries** - Set overall min/max dates
2. **Restricted Periods** - Mark ranges as restricted
3. **Exceptions** - Override restrictions for special cases
4. **Nested Logic** - Rules within rules

### Use Cases

- **Seasonal Business** - "Closed in winter except holidays"
- **Maintenance Windows** - "Monthly maintenance except emergencies"
- **VIP Access** - "Restricted except for special members"
- **Complex Scheduling** - Multiple overlapping rules

## Configuration Reference

### Restriction Types Summary

<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Purpose</th>
      <th>Key Properties</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>weekday</code></td>
      <td>Block days of week</td>
      <td><code>days[]</code> (0-6)</td>
    </tr>
    <tr>
      <td><code>daterange</code></td>
      <td>Block date ranges</td>
      <td><code>ranges[]</code> with start/end</td>
    </tr>
    <tr>
      <td><code>boundary</code></td>
      <td>Set min/max dates</td>
      <td><code>direction</code>, <code>date</code>, <code>inclusive</code></td>
    </tr>
    <tr>
      <td><code>allowedranges</code></td>
      <td>Only allow specific ranges</td>
      <td><code>ranges[]</code> of allowed periods</td>
    </tr>
    <tr>
      <td><code>restricted_boundary</code></td>
      <td>Complex boundaries</td>
      <td><code>minDate</code>, <code>maxDate</code>, <code>ranges[]</code> with exceptions</td>
    </tr>
  </tbody>
</table>

### Common Properties

All restriction types support:
- `type` - The restriction type
- `enabled` - Whether restriction is active
- `message` - User-facing explanation

### Visual Customization

Customize restriction appearance with CSS variables:

```css
--restriction-pattern-color: rgba(139, 92, 246, 0.3);
--restriction-bg-color: rgba(139, 92, 246, 0.05);
--restriction-pattern-size: 8px;
--restriction-pattern-angle: 45deg;
```