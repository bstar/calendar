import { Meta, Story, Canvas } from '@storybook/addon-docs';
import { CLACalendar } from './CLACalendar';
import { createStoryParameters } from './utils/story-helpers';
import {
  FullPlaygroundStory,
  MinimalPlaygroundStory,
  ConfigurationComparisonStory,
  PerformanceTestStory,
  LiveSettingsEditorStory,
  StateManagementStory,
} from './stories/InteractivePlaygroundStories';
import {
  fullPlaygroundCode,
  minimalPlaygroundCode,
  configurationComparisonCode,
  performanceTestCode,
  liveSettingsEditorCode,
  stateManagementCode,
  storybookControlsCode,
  advancedPlaygroundCode,
} from './stories/interactive-playground-code-examples';

<Meta title="Calendar/Interactive Playground" component={CLACalendar} />

# Interactive Playground

Explore all calendar features with live, interactive examples. Test different configurations, experiment with settings, and see real-time updates.

## Overview

The Interactive Playground provides:
- **Live Controls** - Adjust settings and see immediate changes
- **State Management** - Examples of handling calendar state
- **Performance Testing** - Multiple calendar instances
- **Configuration Comparison** - Side-by-side configurations
- **Code Examples** - Copy-ready implementations

## Full Featured Playground

Complete calendar implementation with all features enabled:

<Canvas withSource="open">
  <Story name="Full Featured Demo" parameters={createStoryParameters(fullPlaygroundCode)}>
    {() => <FullPlaygroundStory />}
  </Story>
</Canvas>

**Features included:**
- Date range selection with visual feedback
- Event layers with tooltips
- Background highlights for important periods
- Submit button with callback handling
- Selected range display

## Minimal Playground

Stripped-down calendar for simple date selection:

<Canvas withSource="open">
  <Story name="Minimal Setup Demo" parameters={createStoryParameters(minimalPlaygroundCode)}>
    {() => <MinimalPlaygroundStory />}
  </Story>
</Canvas>

**Minimal configuration:**
- Single date selection
- No header or footer
- Single month view
- Clean, simple interface

## Live Settings Editor

Adjust calendar settings in real-time:

<Canvas withSource="open">
  <Story name="Live Settings Control" parameters={createStoryParameters(liveSettingsEditorCode)}>
    {() => <LiveSettingsEditorStory />}
  </Story>
</Canvas>

**Interactive controls:**
- Visible months slider
- Selection mode toggle
- Color picker for theme
- Feature toggles (header, footer, tooltips)
- Instant visual feedback

## Configuration Comparison

Compare different configurations side-by-side:

<Canvas withSource="open">
  <Story name="Configuration Examples" parameters={createStoryParameters(configurationComparisonCode)}>
    {() => <ConfigurationComparisonStory />}
  </Story>
</Canvas>

**Configurations shown:**
- Default settings
- Single date selection
- Multiple months view
- Custom theme colors

## State Management Example

Track and manage calendar selections:

<Canvas withSource="open">
  <Story name="State Management Demo" parameters={createStoryParameters(stateManagementCode)}>
    {() => <StateManagementStory />}
  </Story>
</Canvas>

**State features:**
- Selection history tracking
- Total selection counter
- Clear history function
- Persistent state display

## Performance Test

Multiple calendar instances for performance testing:

<Canvas withSource="open">
  <Story name="Performance Testing" parameters={createStoryParameters(performanceTestCode)}>
    {() => <PerformanceTestStory />}
  </Story>
</Canvas>

**Performance aspects:**
- 6 calendar instances
- Different configurations
- Render time measurement
- Memory efficiency test

## Using with Storybook Controls

Example of integrating with Storybook's controls addon:

```typescript
// Storybook story with interactive controls
export const InteractiveCalendar: Story = {
  render: (args) => {
    const settings = createCalendarSettings({
      displayMode: args.displayMode || 'embedded',
      visibleMonths: args.visibleMonths || 2,
      selectionMode: args.selectionMode || 'range',
      showSubmitButton: args.showSubmitButton || false,
      showHeader: args.showHeader ?? true,
      showFooter: args.showFooter ?? true,
      showTooltips: args.showTooltips ?? true,
      startWeekOnSunday: args.startWeekOnSunday || false,
      colors: {
        primary: args.primaryColor || '#0366d6',
        success: args.successColor || '#28a745',
        warning: args.warningColor || '#f6c23e',
        danger: args.dangerColor || '#dc3545',
      },
    });

    return <CLACalendar settings={settings} />;
  },
  argTypes: {
    displayMode: {
      control: { type: 'select' },
      options: ['embedded', 'popup'],
      description: 'Calendar display mode',
    },
    visibleMonths: {
      control: { type: 'range', min: 1, max: 6 },
      description: 'Number of months to display',
    },
    selectionMode: {
      control: { type: 'select' },
      options: ['single', 'range'],
      description: 'Date selection mode',
    },
    showSubmitButton: {
      control: 'boolean',
      description: 'Show submit button',
    },
    showHeader: {
      control: 'boolean',
      description: 'Show calendar header',
    },
    showFooter: {
      control: 'boolean',
      description: 'Show calendar footer',
    },
    showTooltips: {
      control: 'boolean',
      description: 'Show tooltips on hover',
    },
    startWeekOnSunday: {
      control: 'boolean',
      description: 'Start week on Sunday',
    },
    primaryColor: {
      control: 'color',
      description: 'Primary theme color',
    },
  },
};
```

**Benefits:**
- Interactive prop exploration
- Real-time updates
- Type-safe controls
- Documentation integration

## Common Implementation Patterns

### Basic Setup

```typescript
import { CLACalendar } from '@cla/calendar';
import { createCalendarSettings } from '@cla/calendar/config';

function MyCalendar() {
  const settings = createCalendarSettings({
    displayMode: 'embedded',
    visibleMonths: 2,
    selectionMode: 'range',
  });

  return <CLACalendar settings={settings} />;
}
```

### With State Management

```typescript
function CalendarWithState() {
  const [selection, setSelection] = useState({ start: null, end: null });

  const handleSubmit = (start, end) => {
    setSelection({ start, end });
    // Additional logic like API calls
  };

  return (
    <>
      <CLACalendar 
        settings={settings}
        onSubmit={handleSubmit}
      />
      <SelectedDatesDisplay selection={selection} />
    </>
  );
}
```

### Dynamic Settings

```typescript
function DynamicCalendar() {
  const [settings, setSettings] = useState(createCalendarSettings({
    // Initial settings
  }));

  const updateSettings = (updates) => {
    setSettings(prev => createCalendarSettings({
      ...prev,
      ...updates
    }));
  };

  return (
    <>
      <SettingsPanel onUpdate={updateSettings} />
      <CLACalendar 
        settings={settings}
        _onSettingsChange={setSettings}
      />
    </>
  );
}
```

## Advanced Playground Features

```typescript
// Advanced playground with multiple features
const AdvancedPlayground = () => {
  const [settings, setSettings] = useState(createCalendarSettings({
    displayMode: 'embedded',
    visibleMonths: 2,
    selectionMode: 'range',
  }));

  const updateSetting = (key: string, value: any) => {
    setSettings(prev => createCalendarSettings({
      ...prev,
      [key]: value
    }));
  };

  return (
    <div>
      <div className="controls">
        {/* Control panel for all settings */}
      </div>
      <CLACalendar 
        settings={settings}
        _onSettingsChange={setSettings}
      />
    </div>
  );
};
```

## Testing Different Scenarios

### 1. Date Selection Modes

Test both single and range selection:
- **Single**: Click a date to select
- **Range**: Click start date, then end date
- **Validation**: Test restricted date handling

### 2. Visual Customization

Experiment with:
- **Colors**: Primary, success, warning, danger
- **Layout**: Month width, visible months
- **Typography**: Base font size
- **Spacing**: Container styles

### 3. Event Integration

Add events and backgrounds:
- **Events**: Meetings, deadlines, holidays
- **Backgrounds**: Highlight date ranges
- **Tooltips**: Rich event information
- **Layers**: Toggle different event types

### 4. Performance Optimization

Test with:
- **Multiple instances**: Resource usage
- **Large date ranges**: Rendering performance
- **Event density**: Many events per month
- **Rapid interactions**: State update speed

## Playground Best Practices

### 1. Start Simple
Begin with minimal configuration and add features incrementally.

### 2. Test Edge Cases
- Empty selections
- Invalid date ranges
- Rapid clicking
- Browser resize

### 3. Monitor Performance
Use browser dev tools to check:
- Render times
- Memory usage
- Event listener count
- Component re-renders

### 4. Accessibility Testing
- Keyboard navigation
- Screen reader compatibility
- Focus management
- Color contrast

## Integration Tips

### With Forms

```typescript
<form onSubmit={handleFormSubmit}>
  <CLACalendar 
    settings={settings}
    onSubmit={(start, end) => {
      setValue('dateRange', { start, end });
    }}
  />
  <button type="submit">Submit Form</button>
</form>
```

### With State Managers

```typescript
// Redux example
const dispatch = useDispatch();
const dateRange = useSelector(selectDateRange);

<CLACalendar 
  settings={settings}
  onSubmit={(start, end) => {
    dispatch(setDateRange({ start, end }));
  }}
/>
```

### With API Calls

```typescript
const handleDateSelection = async (start, end) => {
  const available = await checkAvailability({ start, end });
  if (available) {
    setSelection({ start, end });
  } else {
    showError('Dates not available');
  }
};
```

## Summary

The Interactive Playground demonstrates the flexibility and power of the CLACalendar component. Use these examples as a starting point for your own implementations, and don't hesitate to experiment with different configurations to find what works best for your use case.

Key takeaways:
- Start with `createCalendarSettings()` for type-safe configuration
- Use embedded mode for always-visible calendars
- Implement proper state management for selections
- Test performance with multiple instances
- Customize appearance to match your design system