import { Meta } from '@storybook/addon-docs/blocks';

<Meta title="Edge Cases/Documentation" />

# Edge Cases Documentation

This documentation describes how the CLA Calendar component should handle edge cases, invalid configurations, and problematic inputs. These tests help ensure the component degrades gracefully and provides meaningful feedback when given unexpected data.

> **Note**: To see these edge cases in action with actual calendar instances, visit the "Integrated Examples" page under this section.

## Invalid Numeric Values

Testing how the component handles out-of-range or invalid numeric inputs.

### Negative Visible Months
Tests the calendar with `visibleMonths: -5`. The component should validate and clamp this to a valid range (likely defaulting to 1 or 2 months).

**Configuration:**
```javascript
{
  visibleMonths: -5  // Negative value should be clamped to minimum (1)
}
```

**Expected Behavior:**
- Calendar should display at least 1 month
- No errors or crashes
- Console may show a warning about invalid value

### Excessive Visible Months
Tests the calendar with `visibleMonths: 100`. The component should cap this at a reasonable maximum (typically 12 months).

**Configuration:**
```javascript
{
  visibleMonths: 100  // Should be clamped to maximum (12)
}
```

**Expected Behavior:**
- Calendar displays maximum allowed months (12)
- Performance remains acceptable
- Layout doesn't break

### Zero Visible Months
Tests the calendar with `visibleMonths: 0`. The component should default to showing at least 1 month.

**Configuration:**
```javascript
{
  visibleMonths: 0  // Should default to minimum (1)
}
```

**Expected Behavior:**
- Calendar displays 1 month minimum
- No empty or broken UI

## Date Handling Edge Cases

Testing invalid date configurations and malformed date strings.

### Invalid Date Range
Tests with an invalid date range where the end date (2025-01-01) comes before the start date (2025-12-31). The component should either swap the dates or clear the selection.

**Configuration:**
```javascript
{
  defaultRange: {
    start: '2025-12-31',
    end: '2025-01-01'  // End before start
  }
}
```

**Expected Behavior:**
- Dates may be swapped automatically
- Or selection is cleared/ignored
- No visual glitches in date highlighting

### Malformed Date Strings
Tests with completely invalid date strings. The component should ignore these invalid dates and show no selection.

**Configuration:**
```javascript
{
  defaultRange: {
    start: 'not-a-date',    // Invalid format
    end: '2025-13-45'       // Invalid date (month 13, day 45)
  }
}
```

**Expected Behavior:**
- Invalid dates are ignored
- Calendar shows no selection
- No JavaScript errors thrown
- Possibly logs warnings to console

## Restriction Conflicts

Testing how the component handles conflicting restriction rules.

### Conflicting Restrictions
Tests a scenario where:
- A boundary restriction allows only June 2025 (minDate: '2025-06-01', maxDate: '2025-06-30')
- A daterange restriction blocks the entire month of June 2025

**Configuration:**
```javascript
{
  restrictionConfigFactory: () => ({
    restrictions: [
      {
        type: 'boundary',
        enabled: true,
        minDate: '2025-06-01',
        maxDate: '2025-06-30'
      },
      {
        type: 'daterange',
        enabled: true,
        startDate: '2025-06-01',
        endDate: '2025-06-30'
      }
    ]
  })
}
```

**Expected Behavior:**
- More restrictive rule takes precedence
- Entire June 2025 becomes unselectable
- No conflicting visual states

## Layout Edge Cases

Testing extreme or invalid layout configurations.

### Negative Month Width
Tests the calendar with `monthWidth: -500`. The component should use a default positive width instead.

**Configuration:**
```javascript
{
  monthWidth: -500  // Negative width
}
```

**Expected Behavior:**
- Falls back to default width (500px)
- Layout remains functional
- No rendering errors

### Extremely Small Month Width
Tests the calendar with `monthWidth: 10` pixels. The component should either enforce a minimum width or handle the overflow gracefully.

**Configuration:**
```javascript
{
  monthWidth: 10  // Extremely small
}
```

**Expected Behavior:**
- Content may overflow or be clipped
- Calendar remains interactive
- Possible minimum width enforcement

## Invalid Configuration Values

Testing how the component handles invalid strings, colors, and other configuration values.

### Invalid Timezone
Tests the calendar with an invalid timezone string.

**Configuration:**
```javascript
{
  timezone: 'Not/A/Real/Timezone'
}
```

**Expected Behavior:**
- Falls back to UTC or system timezone
- Date calculations remain consistent
- Warning in console

### Invalid Color Values
Tests the calendar with various invalid color formats.

**Configuration:**
```javascript
{
  colors: {
    primary: 'not-a-color',
    success: '#GGGGGG',      // Invalid hex
    warning: 'rgb(999, 999, 999)',  // Out of range
    danger: '12345'
  }
}
```

**Expected Behavior:**
- Falls back to default colors
- No CSS errors
- Visual styling remains intact

## Layer Configuration Issues

Testing problematic layer configurations.

### Empty Layers with Navigation
Tests with empty layers array but navigation enabled.

**Configuration:**
```javascript
{
  layers: [],
  showLayersNavigation: true
}
```

**Expected Behavior:**
- Navigation UI hidden or shows empty state
- No JavaScript errors
- Calendar remains functional

### Duplicate Layer Names
Tests with multiple layers having the same name identifier.

**Configuration:**
```javascript
{
  layers: [
    {
      name: 'duplicate',
      title: 'First Layer',
      description: 'This is the first layer',
      visible: true,
      enabled: true
    },
    {
      name: 'duplicate',
      title: 'Second Layer',
      description: 'This has the same name as the first',
      visible: true,
      enabled: true
    }
  ],
  showLayersNavigation: true
}
```

**Expected Behavior:**
- May use array indices as fallback
- Or only first/last layer is recognized
- Warning in console about duplicates

## Error Handling

Testing how the component handles functions that throw errors.

### Throwing Date Formatter
Tests with a date formatter function that throws an error.

**Configuration:**
```javascript
{
  dateFormatter: (date) => {
    throw new Error('Date formatter error!');
  }
}
```

**Expected Behavior:**
- Error is caught and handled
- Falls back to default date formatting
- Error logged to console
- Calendar remains functional

## Null and Undefined Handling

Testing how the component handles null and undefined values.

### Null and Undefined Values
Tests with various null and undefined configurations.

**Configuration:**
```javascript
{
  defaultRange: null,
  dateFormatter: undefined,
  colors: null
}
```

**Expected Behavior:**
- Uses default values for null/undefined
- No type errors
- Component initializes normally

## Extreme Values

Testing extreme but technically valid values.

### Extreme Font Sizes
Tests with both extremely small and large font sizes.

**Tiny Font Configuration:**
```javascript
{
  baseFontSize: '0.1rem'  // Nearly invisible
}
```

**Huge Font Configuration:**
```javascript
{
  baseFontSize: '5rem'  // Comically large
}
```

**Expected Behavior:**
- Layout scales with font size
- Calendar remains somewhat usable
- No overflow breaking the container
- All text remains within boundaries

## Summary of Expected Behaviors

When encountering these edge cases, the calendar should:

1. **Validate and clamp numeric values** - Negative or excessive month counts should be clamped to valid ranges (1-12)
2. **Handle invalid dates gracefully** - Invalid date strings should be ignored or default to current date
3. **Resolve restriction conflicts** - More restrictive rules should take precedence
4. **Provide fallbacks for invalid styles** - Invalid colors or dimensions should fall back to defaults
5. **Catch and handle errors** - Functions that throw should not crash the component
6. **Sanitize layer configurations** - Handle duplicates and empty arrays appropriately
7. **Maintain usability** - Even with bad configuration, the calendar should remain somewhat functional

## Developer Notes

These edge cases help identify areas where additional validation or error handling might be needed. If any of these cases cause the component to crash or become completely unusable, it indicates a need for better defensive programming.

### Testing These Cases

To see these edge cases in action:
1. Visit the "Integrated Examples" page under Configuration Stress Tests
2. Each test case shows the exact configuration and resulting calendar behavior
3. Check the browser console for warnings or errors
4. Verify that the calendar degrades gracefully

### Adding New Edge Cases

When adding new edge cases:
1. Document the configuration clearly
2. Describe the expected behavior
3. Add the test to the Integrated Examples page
4. Update this documentation