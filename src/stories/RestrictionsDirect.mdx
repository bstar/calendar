import { Meta } from '@storybook/addon-docs/blocks';
import { useState } from 'react';
import CLACalendar from '../components/CLACalendar';
import { createCalendarSettings } from '../components/CLACalendar.config';
import {
  BoundaryExample,
  WeekdayExample,
  DateRangeExample,
  AllowedRangesExample,
  BusinessDaysExample,
  ComplexExample,
  MonthBoundaryExample,
  SingleDateExample
} from './RestrictionsExamples';

<Meta title="Restrictions/Integrated Examples" />

# Restrictions - Integrated Examples

This page shows working calendar instances with various restriction configurations described in the Restrictions documentation.

## Boundary Restrictions

Calendar restricted to the year 2025 only. Dates before January 1, 2025 and after December 31, 2025 are blocked.

**Full Configuration:**
```javascript
{
  displayMode: 'embedded',
  selectionMode: 'range',
  visibleMonths: 2,
  monthWidth: 300,
  showSubmitButton: true,
  showFooter: true,
  onSubmit: handleSubmit,
  restrictionConfigFactory: () => ({
    restrictions: [{
      type: 'boundary',
      enabled: true,
      date: '2025-01-01',
      direction: 'before',
      inclusive: false,
      message: 'Please select dates in 2025 or later'
    }, {
      type: 'boundary',
      enabled: true,
      date: '2025-12-31',
      direction: 'after',
      inclusive: true,
      message: 'Please select dates in 2025 or earlier'
    }]
  }),
  position: 'bottom-left',
  useDynamicPosition: true,
  showHeader: true,
  showTooltips: true,
  showLayersNavigation: false,
  showDateInputs: true,
  closeOnClickAway: true,
  startWeekOnSunday: false,
  timezone: 'UTC',
  dateRangeSeparator: ' - '
}
```

<BoundaryExample />

## Weekday Restrictions

This calendar blocks weekends (Saturday and Sunday) from selection.

**Full Configuration:**
```javascript
{
  displayMode: 'embedded',
  selectionMode: 'range',
  visibleMonths: 2,
  monthWidth: 300,
  showSubmitButton: true,
  showFooter: true,
  onSubmit: handleSubmit,
  restrictionConfigFactory: () => ({
    restrictions: [{
      type: 'weekday',
      enabled: true,
      days: [0, 6], // Sunday (0) and Saturday (6)
      message: 'Weekends are not available for booking'
    }]
  }),
  // ... other standard settings
}
```

<WeekdayExample />

## Date Range Restrictions

Specific date ranges blocked for holidays and maintenance periods.

**Full Configuration:**
```javascript
{
  displayMode: 'embedded',
  selectionMode: 'range',
  visibleMonths: 2,
  monthWidth: 300,
  showSubmitButton: true,
  showFooter: true,
  onSubmit: handleSubmit,
  restrictionConfigFactory: () => ({
    restrictions: [{
      type: 'daterange',
      enabled: true,
      ranges: [
        {
          startDate: '2025-07-01',
          endDate: '2025-07-07',
          message: 'Company retreat - office closed'
        },
        {
          startDate: '2025-08-15',
          endDate: '2025-08-20',
          message: 'System maintenance period'
        },
        {
          startDate: '2025-12-24',
          endDate: '2025-12-26',
          message: 'Christmas holidays'
        }
      ],
      message: 'This period is not available'
    }]
  }),
  // ... other standard settings
}
```

<DateRangeExample />

## Allowed Ranges (Whitelist)

Only specific date ranges are selectable - useful for seasonal availability.

**Full Configuration:**
```javascript
{
  displayMode: 'embedded',
  selectionMode: 'range',
  visibleMonths: 2,
  monthWidth: 300,
  showSubmitButton: true,
  showFooter: true,
  onSubmit: handleSubmit,
  restrictionConfigFactory: () => ({
    restrictions: [{
      type: 'allowedranges',
      enabled: true,
      ranges: [
        {
          startDate: '2025-07-01',
          endDate: '2025-07-31',
          message: 'Summer availability'
        },
        {
          startDate: '2025-12-15',
          endDate: '2025-12-31',
          message: 'Winter holiday season'
        }
      ],
      message: 'Please select dates within the available periods'
    }]
  }),
  // ... other standard settings
}
```

<AllowedRangesExample />

## Business Days Pattern

Common business application pattern: weekdays only with holidays blocked.

**Full Configuration:**
```javascript
{
  displayMode: 'embedded',
  selectionMode: 'range',
  visibleMonths: 2,
  monthWidth: 300,
  showSubmitButton: true,
  showFooter: true,
  onSubmit: handleSubmit,
  restrictionConfigFactory: () => ({
    restrictions: [
      {
        type: 'weekday',
        enabled: true,
        days: [0, 6], // Block weekends
        message: 'Please select a business day (Monday-Friday)'
      },
      {
        type: 'daterange',
        enabled: true,
        ranges: [
          {
            startDate: '2025-07-04',
            endDate: '2025-07-04',
            message: 'Independence Day'
          },
          {
            startDate: '2025-09-01',
            endDate: '2025-09-01',
            message: 'Labor Day'
          },
          {
            startDate: '2025-11-27',
            endDate: '2025-11-28',
            message: 'Thanksgiving Holiday'
          },
          {
            startDate: '2025-12-24',
            endDate: '2025-12-25',
            message: 'Christmas Holiday'
          }
        ],
        message: 'Federal holiday - office closed'
      }
    ]
  }),
  // ... other standard settings
}
```

<BusinessDaysExample />

## Complex Restrictions Example

Multiple restriction types combined with boundaries, weekdays, and specific date ranges.

**Full Configuration:**
```javascript
{
  displayMode: 'embedded',
  selectionMode: 'range',
  visibleMonths: 2,
  monthWidth: 300,
  showSubmitButton: true,
  showFooter: true,
  onSubmit: handleSubmit,
  restrictionConfigFactory: () => ({
    restrictions: [
      {
        type: 'boundary',
        enabled: true,
        date: '2025-07-01',
        direction: 'before',
        message: 'Bookings open July 1st, 2025'
      },
      {
        type: 'boundary',
        enabled: true,
        date: '2025-12-31',
        direction: 'after',
        message: 'Cannot book beyond 2025'
      },
      {
        type: 'weekday',
        enabled: true,
        days: [0, 6],
        message: 'Service not available on weekends'
      },
      {
        type: 'daterange',
        enabled: true,
        ranges: [
          {
            startDate: '2025-07-04',
            endDate: '2025-07-04',
            message: 'Closed for Independence Day'
          },
          {
            startDate: '2025-09-01',
            endDate: '2025-09-01',
            message: 'Closed for Labor Day'
          },
          {
            startDate: '2025-11-27',
            endDate: '2025-11-28',
            message: 'Closed for Thanksgiving'
          },
          {
            startDate: '2025-12-24',
            endDate: '2025-12-26',
            message: 'Closed for Christmas'
          }
        ]
      }
    ]
  }),
  // ... other standard settings
}
```

<ComplexExample />

## Month Boundary Restriction

This example demonstrates the calendar's built-in boundary behavior. When you start a selection within a specific month, you can only continue selecting dates within that same month. All dates in other months become automatically restricted.

**Full Configuration:**
```javascript
{
  displayMode: 'embedded',
  selectionMode: 'range',
  visibleMonths: 2,
  monthWidth: 300,
  showSubmitButton: true,
  showFooter: true,
  onSubmit: handleSubmit,
  restrictionConfigFactory: () => ({
    restrictions: [{
      type: 'restricted_boundary',
      enabled: true,
      ranges: [
        {
          startDate: '2025-07-01',
          endDate: '2025-07-31',
          restricted: false,  // This range is ALLOWED
          message: 'July 2025'
        },
        {
          startDate: '2025-08-01',
          endDate: '2025-08-31',
          restricted: false,  // This range is ALLOWED
          message: 'August 2025'
        },
        {
          startDate: '2025-09-01',
          endDate: '2025-09-30',
          restricted: false,  // This range is ALLOWED
          message: 'September 2025'
        }
      ],
      message: 'Selection must stay within the same month'
    }]
  })
}
```

<MonthBoundaryExample />

## Single Date Selection with Restrictions

Appointment scheduling example with specific days available.

**Full Configuration:**
```javascript
{
  displayMode: 'embedded',
  selectionMode: 'single',  // Single date selection
  visibleMonths: 2,
  monthWidth: 300,
  showSubmitButton: true,
  showFooter: true,
  onSubmit: handleSubmit,
  restrictionConfigFactory: () => ({
    restrictions: [
      {
        type: 'weekday',
        enabled: true,
        days: [1, 3, 5], // Block Monday, Wednesday, Friday
        message: 'Available on Tuesday, Thursday, and weekends only'
      },
      {
        type: 'boundary',
        enabled: true,
        date: new Date().toISOString().split('T')[0],
        direction: 'before',
        message: 'Please select a future date'
      }
    ]
  }),
  // ... other standard settings
}
```

<SingleDateExample />

## Configuration Reference

### Restriction Factory

The `restrictionConfigFactory` function is called each time the calendar needs to evaluate restrictions. This allows for dynamic restriction generation:

```typescript
restrictionConfigFactory: () => {
  // Can fetch data or compute restrictions dynamically
  const currentDate = new Date();
  const restrictions = [];
  
  // Add dynamic restrictions based on current state
  if (blockPastDates) {
    restrictions.push({
      type: 'boundary',
      enabled: true,
      date: currentDate.toISOString().split('T')[0],
      direction: 'before',
      message: 'Cannot select past dates'
    });
  }
  
  return { restrictions };
}
```

### Common Restriction Patterns

#### 1. Past Date Blocking
```javascript
{
  type: 'boundary',
  enabled: true,
  date: new Date().toISOString().split('T')[0],
  direction: 'before',
  inclusive: false,
  message: 'Please select a future date'
}
```

#### 2. Business Days Only
```javascript
{
  type: 'weekday',
  enabled: true,
  days: [0, 6], // Sunday and Saturday
  message: 'Available Monday-Friday only'
}
```

#### 3. Holiday Blocking
```javascript
{
  type: 'daterange',
  enabled: true,
  ranges: holidays.map(h => ({
    startDate: h.date,
    endDate: h.date,
    message: h.name
  }))
}
```

#### 4. Booking Window
```javascript
// Min 1 day in advance, max 90 days
const tomorrow = new Date();
tomorrow.setDate(tomorrow.getDate() + 1);

const maxDate = new Date();
maxDate.setDate(maxDate.getDate() + 90);

restrictions: [
  {
    type: 'boundary',
    enabled: true,
    date: tomorrow.toISOString().split('T')[0],
    direction: 'before',
    message: 'Must book at least 1 day in advance'
  },
  {
    type: 'boundary',
    enabled: true,
    date: maxDate.toISOString().split('T')[0],
    direction: 'after',
    message: 'Cannot book more than 90 days ahead'
  }
]
```

### Visual Indicators

Restricted dates are visually indicated with:
- **Gray background**: Date is restricted
- **Strikethrough text**: Clear visual cue
- **Hover tooltip**: Shows restriction message
- **Cursor style**: Changes to indicate non-selectable

### Performance Tips

1. **Cache Restriction Data**: If restrictions are fetched from an API, cache the results
2. **Minimize Computations**: Keep the factory function lightweight
3. **Use Memoization**: For complex calculations, memoize results
4. **Batch Updates**: When changing multiple restrictions, update them together
5. **Limit Boundary Ranges**: For `restricted_boundary` type, limit ranges to what's needed. Each day cell checks all boundaries, so 6 ranges × 60 day cells = 360 checks per render

### Testing Restrictions

To test your restrictions:
1. Try to select restricted dates
2. Verify tooltip messages appear
3. Check that the submit callback receives valid dates only
4. Test edge cases (boundaries, single days, etc.)
5. Verify visual feedback is consistent